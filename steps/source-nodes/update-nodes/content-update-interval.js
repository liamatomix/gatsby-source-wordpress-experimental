"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports.startPollingForContentUpdates = void 0;

require("source-map-support/register");

var _fetchNodeUpdates = _interopRequireDefault(require("./fetch-node-updates"));

var _formatLogMessage = require("../../../utils/format-log-message");

var _store = _interopRequireDefault(require("../../../store"));

const refetcher = async msRefetchInterval => {
  await (0, _fetchNodeUpdates.default)({
    intervalRefetching: true
  });
  setTimeout(() => refetcher(msRefetchInterval), msRefetchInterval);
};
/**
 * Starts constantly refetching the latest WordPress changes
 * so we can update Gatsby nodes when data changes
 */


const startPollingForContentUpdates = (helpers, pluginOptions) => {
  if (process.env.WP_DISABLE_POLLING) {
    return;
  }

  const {
    verbose
  } = _store.default.getState().gatsbyApi.pluginOptions;

  const msRefetchInterval = pluginOptions && pluginOptions.develop && pluginOptions.develop.nodeUpdateInterval ? pluginOptions.develop.nodeUpdateInterval : 300;

  if (verbose) {
    helpers.reporter.log(``);
    helpers.reporter.info((0, _formatLogMessage.formatLogMessage)`Watching for WordPress changes`);
  }

  refetcher(msRefetchInterval);
};

exports.startPollingForContentUpdates = startPollingForContentUpdates;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zdGVwcy9zb3VyY2Utbm9kZXMvdXBkYXRlLW5vZGVzL2NvbnRlbnQtdXBkYXRlLWludGVydmFsLmpzIl0sIm5hbWVzIjpbInJlZmV0Y2hlciIsIm1zUmVmZXRjaEludGVydmFsIiwiaW50ZXJ2YWxSZWZldGNoaW5nIiwic2V0VGltZW91dCIsInN0YXJ0UG9sbGluZ0ZvckNvbnRlbnRVcGRhdGVzIiwiaGVscGVycyIsInBsdWdpbk9wdGlvbnMiLCJwcm9jZXNzIiwiZW52IiwiV1BfRElTQUJMRV9QT0xMSU5HIiwidmVyYm9zZSIsInN0b3JlIiwiZ2V0U3RhdGUiLCJnYXRzYnlBcGkiLCJkZXZlbG9wIiwibm9kZVVwZGF0ZUludGVydmFsIiwicmVwb3J0ZXIiLCJsb2ciLCJpbmZvIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxTQUFTLEdBQUcsTUFBT0MsaUJBQVAsSUFBNkI7QUFDN0MsUUFBTSwrQkFBeUI7QUFDN0JDLElBQUFBLGtCQUFrQixFQUFFO0FBRFMsR0FBekIsQ0FBTjtBQUlBQyxFQUFBQSxVQUFVLENBQUMsTUFBTUgsU0FBUyxDQUFDQyxpQkFBRCxDQUFoQixFQUFxQ0EsaUJBQXJDLENBQVY7QUFDRCxDQU5EO0FBUUE7Ozs7OztBQUlBLE1BQU1HLDZCQUE2QixHQUFHLENBQUNDLE9BQUQsRUFBVUMsYUFBVixLQUE0QjtBQUNoRSxNQUFJQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsa0JBQWhCLEVBQW9DO0FBQ2xDO0FBQ0Q7O0FBRUQsUUFBTTtBQUFFQyxJQUFBQTtBQUFGLE1BQWNDLGVBQU1DLFFBQU4sR0FBaUJDLFNBQWpCLENBQTJCUCxhQUEvQzs7QUFFQSxRQUFNTCxpQkFBaUIsR0FDckJLLGFBQWEsSUFDYkEsYUFBYSxDQUFDUSxPQURkLElBRUFSLGFBQWEsQ0FBQ1EsT0FBZCxDQUFzQkMsa0JBRnRCLEdBR0lULGFBQWEsQ0FBQ1EsT0FBZCxDQUFzQkMsa0JBSDFCLEdBSUksR0FMTjs7QUFPQSxNQUFJTCxPQUFKLEVBQWE7QUFDWEwsSUFBQUEsT0FBTyxDQUFDVyxRQUFSLENBQWlCQyxHQUFqQixDQUFzQixFQUF0QjtBQUNBWixJQUFBQSxPQUFPLENBQUNXLFFBQVIsQ0FBaUJFLElBQWpCLENBQXNCLHVDQUFpQixnQ0FBdkM7QUFDRDs7QUFFRGxCLEVBQUFBLFNBQVMsQ0FBQ0MsaUJBQUQsQ0FBVDtBQUNELENBcEJEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZldGNoQW5kQXBwbHlOb2RlVXBkYXRlcyBmcm9tIFwiLi9mZXRjaC1ub2RlLXVwZGF0ZXNcIlxuaW1wb3J0IHsgZm9ybWF0TG9nTWVzc2FnZSB9IGZyb20gXCJ+L3V0aWxzL2Zvcm1hdC1sb2ctbWVzc2FnZVwiXG5pbXBvcnQgc3RvcmUgZnJvbSBcIn4vc3RvcmVcIlxuXG5jb25zdCByZWZldGNoZXIgPSBhc3luYyAobXNSZWZldGNoSW50ZXJ2YWwpID0+IHtcbiAgYXdhaXQgZmV0Y2hBbmRBcHBseU5vZGVVcGRhdGVzKHtcbiAgICBpbnRlcnZhbFJlZmV0Y2hpbmc6IHRydWUsXG4gIH0pXG5cbiAgc2V0VGltZW91dCgoKSA9PiByZWZldGNoZXIobXNSZWZldGNoSW50ZXJ2YWwpLCBtc1JlZmV0Y2hJbnRlcnZhbClcbn1cblxuLyoqXG4gKiBTdGFydHMgY29uc3RhbnRseSByZWZldGNoaW5nIHRoZSBsYXRlc3QgV29yZFByZXNzIGNoYW5nZXNcbiAqIHNvIHdlIGNhbiB1cGRhdGUgR2F0c2J5IG5vZGVzIHdoZW4gZGF0YSBjaGFuZ2VzXG4gKi9cbmNvbnN0IHN0YXJ0UG9sbGluZ0ZvckNvbnRlbnRVcGRhdGVzID0gKGhlbHBlcnMsIHBsdWdpbk9wdGlvbnMpID0+IHtcbiAgaWYgKHByb2Nlc3MuZW52LldQX0RJU0FCTEVfUE9MTElORykge1xuICAgIHJldHVyblxuICB9XG5cbiAgY29uc3QgeyB2ZXJib3NlIH0gPSBzdG9yZS5nZXRTdGF0ZSgpLmdhdHNieUFwaS5wbHVnaW5PcHRpb25zXG5cbiAgY29uc3QgbXNSZWZldGNoSW50ZXJ2YWwgPVxuICAgIHBsdWdpbk9wdGlvbnMgJiZcbiAgICBwbHVnaW5PcHRpb25zLmRldmVsb3AgJiZcbiAgICBwbHVnaW5PcHRpb25zLmRldmVsb3Aubm9kZVVwZGF0ZUludGVydmFsXG4gICAgICA/IHBsdWdpbk9wdGlvbnMuZGV2ZWxvcC5ub2RlVXBkYXRlSW50ZXJ2YWxcbiAgICAgIDogMzAwXG5cbiAgaWYgKHZlcmJvc2UpIHtcbiAgICBoZWxwZXJzLnJlcG9ydGVyLmxvZyhgYClcbiAgICBoZWxwZXJzLnJlcG9ydGVyLmluZm8oZm9ybWF0TG9nTWVzc2FnZWBXYXRjaGluZyBmb3IgV29yZFByZXNzIGNoYW5nZXNgKVxuICB9XG5cbiAgcmVmZXRjaGVyKG1zUmVmZXRjaEludGVydmFsKVxufVxuXG5leHBvcnQgeyBzdGFydFBvbGxpbmdGb3JDb250ZW50VXBkYXRlcyB9XG4iXX0=