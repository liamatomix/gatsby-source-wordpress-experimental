"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports.ensurePluginRequirementsAreMet = void 0;

require("source-map-support/register");

var _fetchGraphql = _interopRequireDefault(require("../utils/fetch-graphql"));

var _formatLogMessage = require("../utils/format-log-message");

var _getGatsbyApi = require("../utils/get-gatsby-api");

var _supportedRemotePluginVersions = require("../supported-remote-plugin-versions");

const areRemotePluginVersionsSatisfied = async ({
  helpers
}) => {
  let wpgqlIsSatisfied;
  let wpGatsbyIsSatisfied;

  try {
    const {
      data
    } = await (0, _fetchGraphql.default)({
      query:
      /* GraphQL */
      `
        query WPGatsbyCompatibility(
          $wpgqlVersion: String!
          $wpgatsbyVersion: String!
        ) {
          wpGatsbyCompatibility(
            wpGatsbyVersionRange: $wpgatsbyVersion
            wpGQLVersionRange: $wpgqlVersion
          ) {
            satisfies {
              wpGQL
              wpGatsby
            }
          }
        }
      `,
      variables: {
        wpgqlVersion: _supportedRemotePluginVersions.supportedWpPluginVersions.WPGraphQL.version,
        wpgatsbyVersion: _supportedRemotePluginVersions.supportedWpPluginVersions.WPGatsby.version
      },
      panicOnError: false,
      throwGqlErrors: true
    });
    wpgqlIsSatisfied = data.wpGatsbyCompatibility.satisfies.wpGQL;
    wpGatsbyIsSatisfied = data.wpGatsbyCompatibility.satisfies.wpGatsby;
  } catch (e) {
    if (e.message.includes(`Cannot query field "wpGatsbyCompatibility" on type "RootQuery".`)) {
      helpers.reporter.panic((0, _formatLogMessage.formatLogMessage)(`Your version of WPGatsby is too old to determine if we're compatible.${_supportedRemotePluginVersions.genericDownloadMessage}`));
    } else {
      helpers.reporter.panic(e.message);
    }
  } // a message explaining why these are the minimum versions


  const reasons = `${_supportedRemotePluginVersions.supportedWpPluginVersions.WPGraphQL.reason || _supportedRemotePluginVersions.supportedWpPluginVersions.WPGatsby.reason ? `\n\nReasons:\n\n` : ``}${_supportedRemotePluginVersions.supportedWpPluginVersions.WPGraphQL.reason ? `- ${_supportedRemotePluginVersions.supportedWpPluginVersions.WPGraphQL.reason}` : ``}${_supportedRemotePluginVersions.supportedWpPluginVersions.WPGraphQL.reason && _supportedRemotePluginVersions.supportedWpPluginVersions.WPGatsby.reason ? `\n\n` : ``}${_supportedRemotePluginVersions.supportedWpPluginVersions.WPGatsby.reason ? `- ${_supportedRemotePluginVersions.supportedWpPluginVersions.WPGatsby.reason}` : ``}`;
  let message;

  if (!wpgqlIsSatisfied && wpGatsbyIsSatisfied) {
    message = `Your remote version of WPGraphQL is not within the accepted range (${_supportedRemotePluginVersions.supportedWpPluginVersions.WPGraphQL.version}).

\tDownload v ${_supportedRemotePluginVersions.supportedWpPluginVersions.WPGraphQL.version} at https://github.com/wp-graphql/wp-graphql/releases

\tIf you're upgrading from an earlier version, read the release notes for each version between your old and new versions to determine which breaking changes you might encounter based on your use of the schema.
${reasons}
`;
  }

  if (!wpGatsbyIsSatisfied) {
    message = `Your remote version of WPGatsby is not within the accepted range (${_supportedRemotePluginVersions.supportedWpPluginVersions.WPGatsby.version})

\tDownload v ${_supportedRemotePluginVersions.supportedWpPluginVersions.WPGatsby.version} at https://github.com/TylerBarnes/using-gatsby-source-wordpress-experimental/tree/master/WordPress/plugins
${reasons}`;
  }

  if (!wpGatsbyIsSatisfied && !wpgqlIsSatisfied) {
    message = `WPGatsby and WPGraphQL are both outside the accepted version ranges.
visit https://github.com/TylerBarnes/using-gatsby-source-wordpress-experimental/tree/master/WordPress/plugins to download the latest versions.
${reasons}`;
  }

  if (message) {
    helpers.reporter.panic((0, _formatLogMessage.formatLogMessage)(message));
  }
};

const isWpGatsby = async () => (0, _fetchGraphql.default)({
  query:
  /* GraphQL */
  `
      {
        isWpGatsby
      }
    `,
  errorMap: {
    from: `Cannot query field "isWpGatsby" on type "RootQuery".`,
    // @todo replace this link with another once we're out of alpha
    to: `WPGatsby is not active in your WordPress installation.\nTo download the latest versions of WPGatsby and WPGraphL, visit:\nhttps://github.com/TylerBarnes/using-gatsby-source-wordpress-experimental/tree/master/WordPress/plugins`
  },
  panicOnError: true
});

const ensurePluginRequirementsAreMet = async (helpers, _pluginOptions) => {
  if (helpers.traceId === `refresh-createSchemaCustomization`) {
    return;
  }

  const {
    debug: {
      disableCompatibilityCheck
    }
  } = (0, _getGatsbyApi.getPluginOptions)();
  await isWpGatsby();

  if (!disableCompatibilityCheck) {
    await areRemotePluginVersionsSatisfied({
      helpers
    });
  }
};

exports.ensurePluginRequirementsAreMet = ensurePluginRequirementsAreMet;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zdGVwcy9jaGVjay1wbHVnaW4tcmVxdWlyZW1lbnRzLmpzIl0sIm5hbWVzIjpbImFyZVJlbW90ZVBsdWdpblZlcnNpb25zU2F0aXNmaWVkIiwiaGVscGVycyIsIndwZ3FsSXNTYXRpc2ZpZWQiLCJ3cEdhdHNieUlzU2F0aXNmaWVkIiwiZGF0YSIsInF1ZXJ5IiwidmFyaWFibGVzIiwid3BncWxWZXJzaW9uIiwic3VwcG9ydGVkV3BQbHVnaW5WZXJzaW9ucyIsIldQR3JhcGhRTCIsInZlcnNpb24iLCJ3cGdhdHNieVZlcnNpb24iLCJXUEdhdHNieSIsInBhbmljT25FcnJvciIsInRocm93R3FsRXJyb3JzIiwid3BHYXRzYnlDb21wYXRpYmlsaXR5Iiwic2F0aXNmaWVzIiwid3BHUUwiLCJ3cEdhdHNieSIsImUiLCJtZXNzYWdlIiwiaW5jbHVkZXMiLCJyZXBvcnRlciIsInBhbmljIiwiZ2VuZXJpY0Rvd25sb2FkTWVzc2FnZSIsInJlYXNvbnMiLCJyZWFzb24iLCJpc1dwR2F0c2J5IiwiZXJyb3JNYXAiLCJmcm9tIiwidG8iLCJlbnN1cmVQbHVnaW5SZXF1aXJlbWVudHNBcmVNZXQiLCJfcGx1Z2luT3B0aW9ucyIsInRyYWNlSWQiLCJkZWJ1ZyIsImRpc2FibGVDb21wYXRpYmlsaXR5Q2hlY2siXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUVBOztBQUVBOztBQUtBLE1BQU1BLGdDQUFnQyxHQUFHLE9BQU87QUFBRUMsRUFBQUE7QUFBRixDQUFQLEtBQXVCO0FBQzlELE1BQUlDLGdCQUFKO0FBQ0EsTUFBSUMsbUJBQUo7O0FBRUEsTUFBSTtBQUNGLFVBQU07QUFBRUMsTUFBQUE7QUFBRixRQUFXLE1BQU0sMkJBQWE7QUFDbENDLE1BQUFBLEtBQUs7QUFBRTtBQUFlOzs7Ozs7Ozs7Ozs7Ozs7T0FEWTtBQWlCbENDLE1BQUFBLFNBQVMsRUFBRTtBQUNUQyxRQUFBQSxZQUFZLEVBQUVDLHlEQUEwQkMsU0FBMUIsQ0FBb0NDLE9B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RUFBRTtBQUFFQyxNQUFBQTtBQUFGO0FBREgsTUFFRixxQ0FGSjtBQUlBLFFBQU1SLFVBQVUsRUFBaEI7O0FBRUEsTUFBSSxDQUFDUSx5QkFBTCxFQUFnQztBQUM5QixVQUFNbkMsZ0NBQWdDLENBQUM7QUFBRUMsTUFBQUE7QUFBRixLQUFELENBQXRDO0FBQ0Q7QUFDRixDQWREIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZldGNoR3JhcGhxbCBmcm9tIFwifi91dGlscy9mZXRjaC1ncmFwaHFsXCJcbmltcG9ydCB7IGZvcm1hdExvZ01lc3NhZ2UgfSBmcm9tIFwifi91dGlscy9mb3JtYXQtbG9nLW1lc3NhZ2VcIlxuXG5pbXBvcnQgeyBnZXRQbHVnaW5PcHRpb25zIH0gZnJvbSBcIn4vdXRpbHMvZ2V0LWdhdHNieS1hcGlcIlxuXG5pbXBvcnQge1xuICBzdXBwb3J0ZWRXcFBsdWdpblZlcnNpb25zLFxuICBnZW5lcmljRG93bmxvYWRNZXNzYWdlLFxufSBmcm9tIFwifi9zdXBwb3J0ZWQtcmVtb3RlLXBsdWdpbi12ZXJzaW9uc1wiXG5cbmNvbnN0IGFyZVJlbW90ZVBsdWdpblZlcnNpb25zU2F0aXNmaWVkID0gYXN5bmMgKHsgaGVscGVycyB9KSA9PiB7XG4gIGxldCB3cGdxbElzU2F0aXNmaWVkXG4gIGxldCB3cEdhdHNieUlzU2F0aXNmaWVkXG5cbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGZldGNoR3JhcGhxbCh7XG4gICAgICBxdWVyeTogLyogR3JhcGhRTCAqLyBgXG4gICAgICAgIHF1ZXJ5IFdQR2F0c2J5Q29tcGF0aWJpbGl0eShcbiAgICAgICAgICAkd3BncWxWZXJzaW9uOiBTdHJpbmchXG4gICAgICAgICAgJHdwZ2F0c2J5VmVyc2lvbjogU3RyaW5nIVxuICAgICAgICApIHtcbiAgICAgICAgICB3cEdhdHNieUNvbXBhdGliaWxpdHkoXG4gICAgICAgICAgICB3cEdhdHNieVZlcnNpb25SYW5nZTogJHdwZ2F0c2J5VmVyc2lvblxuICAgICAgICAgICAgd3BHUUxWZXJzaW9uUmFuZ2U6ICR3cGdxbFZlcnNpb25cbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHNhdGlzZmllcyB7XG4gICAgICAgICAgICAgIHdwR1FMXG4gICAgICAgICAgICAgIHdwR2F0c2J5XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICBgLFxuICAgICAgdmFyaWFibGVzOiB7XG4gICAgICAgIHdwZ3FsVmVyc2lvbjogc3VwcG9ydGVkV3BQbHVnaW5WZXJzaW9ucy5XUEdyYXBoUUwudmVyc2lvbixcbiAgICAgICAgd3BnYXRzYnlWZXJzaW9uOiBzdXBwb3J0ZWRXcFBsdWdpblZlcnNpb25zLldQR2F0c2J5LnZlcnNpb24sXG4gICAgICB9LFxuICAgICAgcGFuaWNPbkVycm9yOiBmYWxzZSxcbiAgICAgIHRocm93R3FsRXJyb3JzOiB0cnVlLFxuICAgIH0pXG5cbiAgICB3cGdxbElzU2F0aXNmaWVkID0gZGF0YS53cEdhdHNieUNvbXBhdGliaWxpdHkuc2F0aXNmaWVzLndwR1FMXG4gICAgd3BHYXRzYnlJc1NhdGlzZmllZCA9IGRhdGEud3BHYXRzYnlDb21wYXRpYmlsaXR5LnNhdGlzZmllcy53cEdhdHNieVxuICB9IGNhdGNoIChlKSB7XG4gICAgaWYgKFxuICAgICAgZS5tZXNzYWdlLmluY2x1ZGVzKFxuICAgICAgICBgQ2Fubm90IHF1ZXJ5IGZpZWxkIFwid3BHYXRzYnlDb21wYXRpYmlsaXR5XCIgb24gdHlwZSBcIlJvb3RRdWVyeVwiLmBcbiAgICAgIClcbiAgICApIHtcbiAgICAgIGhlbHBlcnMucmVwb3J0ZXIucGFuaWMoXG4gICAgICAgIGZvcm1hdExvZ01lc3NhZ2UoXG4gICAgICAgICAgYFlvdXIgdmVyc2lvbiBvZiBXUEdhdHNieSBpcyB0b28gb2xkIHRvIGRldGVybWluZSBpZiB3ZSdyZSBjb21wYXRpYmxlLiR7Z2VuZXJpY0Rvd25sb2FkTWVzc2FnZX1gXG4gICAgICAgIClcbiAgICAgIClcbiAgICB9IGVsc2Uge1xuICAgICAgaGVscGVycy5yZXBvcnRlci5wYW5pYyhlLm1lc3NhZ2UpXG4gICAgfVxuICB9XG5cbiAgLy8gYSBtZXNzYWdlIGV4cGxhaW5pbmcgd2h5IHRoZXNlIGFyZSB0aGUgbWluaW11bSB2ZXJzaW9uc1xuICBjb25zdCByZWFzb25zID0gYCR7XG4gICAgc3VwcG9ydGVkV3BQbHVnaW5WZXJzaW9ucy5XUEdyYXBoUUwucmVhc29uIHx8XG4gICAgc3VwcG9ydGVkV3BQbHVnaW5WZXJzaW9ucy5XUEdhdHNieS5yZWFzb25cbiAgICAgID8gYFxcblxcblJlYXNvbnM6XFxuXFxuYFxuICAgICAgOiBgYFxuICB9JHtcbiAgICBzdXBwb3J0ZWRXcFBsdWdpblZlcnNpb25zLldQR3JhcGhRTC5yZWFzb25cbiAgICAgID8gYC0gJHtzdXBwb3J0ZWRXcFBsdWdpblZlcnNpb25zLldQR3JhcGhRTC5yZWFzb259YFxuICAgICAgOiBgYFxuICB9JHtcbiAgICBzdXBwb3J0ZWRXcFBsdWdpblZlcnNpb25zLldQR3JhcGhRTC5yZWFzb24gJiZcbiAgICBzdXBwb3J0ZWRXcFBsdWdpblZlcnNpb25zLldQR2F0c2J5LnJlYXNvblxuICAgICAgPyBgXFxuXFxuYFxuICAgICAgOiBgYFxuICB9JHtcbiAgICBzdXBwb3J0ZWRXcFBsdWdpblZlcnNpb25zLldQR2F0c2J5LnJlYXNvblxuICAgICAgPyBgLSAke3N1cHBvcnRlZFdwUGx1Z2luVmVyc2lvbnMuV1BHYXRzYnkucmVhc29ufWBcbiAgICAgIDogYGBcbiAgfWBcblxuICBsZXQgbWVzc2FnZVxuXG4gIGlmICghd3BncWxJc1NhdGlzZmllZCAmJiB3cEdhdHNieUlzU2F0aXNmaWVkKSB7XG4gICAgbWVzc2FnZSA9IGBZb3VyIHJlbW90ZSB2ZXJzaW9uIG9mIFdQR3JhcGhRTCBpcyBub3Qgd2l0aGluIHRoZSBhY2NlcHRlZCByYW5nZSAoJHtzdXBwb3J0ZWRXcFBsdWdpblZlcnNpb25zLldQR3JhcGhRTC52ZXJzaW9ufSkuXG5cblxcdERvd25sb2FkIHYgJHtzdXBwb3J0ZWRXcFBsdWdpblZlcnNpb25zLldQR3JhcGhRTC52ZXJzaW9ufSBhdCBodHRwczovL2dpdGh1Yi5jb20vd3AtZ3JhcGhxbC93cC1ncmFwaHFsL3JlbGVhc2VzXG5cblxcdElmIHlvdSdyZSB1cGdyYWRpbmcgZnJvbSBhbiBlYXJsaWVyIHZlcnNpb24sIHJlYWQgdGhlIHJlbGVhc2Ugbm90ZXMgZm9yIGVhY2ggdmVyc2lvbiBiZXR3ZWVuIHlvdXIgb2xkIGFuZCBuZXcgdmVyc2lvbnMgdG8gZGV0ZXJtaW5lIHdoaWNoIGJyZWFraW5nIGNoYW5nZXMgeW91IG1pZ2h0IGVuY291bnRlciBiYXNlZCBvbiB5b3VyIHVzZSBvZiB0aGUgc2NoZW1hLlxuJHtyZWFzb25zfVxuYFxuICB9XG5cbiAgaWYgKCF3cEdhdHNieUlzU2F0aXNmaWVkKSB7XG4gICAgbWVzc2FnZSA9IGBZb3VyIHJlbW90ZSB2ZXJzaW9uIG9mIFdQR2F0c2J5IGlzIG5vdCB3aXRoaW4gdGhlIGFjY2VwdGVkIHJhbmdlICgke3N1cHBvcnRlZFdwUGx1Z2luVmVyc2lvbnMuV1BHYXRzYnkudmVyc2lvbn0pXG5cblxcdERvd25sb2FkIHYgJHtzdXBwb3J0ZWRXcFBsdWdpblZlcnNpb25zLldQR2F0c2J5LnZlcnNpb259IGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9UeWxlckJhcm5lcy91c2luZy1nYXRzYnktc291cmNlLXdvcmRwcmVzcy1leHBlcmltZW50YWwvdHJlZS9tYXN0ZXIvV29yZFByZXNzL3BsdWdpbnNcbiR7cmVhc29uc31gXG4gIH1cblxuICBpZiAoIXdwR2F0c2J5SXNTYXRpc2ZpZWQgJiYgIXdwZ3FsSXNTYXRpc2ZpZWQpIHtcbiAgICBtZXNzYWdlID0gYFdQR2F0c2J5IGFuZCBXUEdyYXBoUUwgYXJlIGJvdGggb3V0c2lkZSB0aGUgYWNjZXB0ZWQgdmVyc2lvbiByYW5nZXMuXG52aXNpdCBodHRwczovL2dpdGh1Yi5jb20vVHlsZXJCYXJuZXMvdXNpbmctZ2F0c2J5LXNvdXJjZS13b3JkcHJlc3MtZXhwZXJpbWVudGFsL3RyZWUvbWFzdGVyL1dvcmRQcmVzcy9wbHVnaW5zIHRvIGRvd25sb2FkIHRoZSBsYXRlc3QgdmVyc2lvbnMuXG4ke3JlYXNvbnN9YFxuICB9XG5cbiAgaWYgKG1lc3NhZ2UpIHtcbiAgICBoZWxwZXJzLnJlcG9ydGVyLnBhbmljKGZvcm1hdExvZ01lc3NhZ2UobWVzc2FnZSkpXG4gIH1cbn1cblxuY29uc3QgaXNXcEdhdHNieSA9IGFzeW5jICgpID0+XG4gIGZldGNoR3JhcGhxbCh7XG4gICAgcXVlcnk6IC8qIEdyYXBoUUwgKi8gYFxuICAgICAge1xuICAgICAgICBpc1dwR2F0c2J5XG4gICAgICB9XG4gICAgYCxcbiAgICBlcnJvck1hcDoge1xuICAgICAgZnJvbTogYENhbm5vdCBxdWVyeSBmaWVsZCBcImlzV3BHYXRzYnlcIiBvbiB0eXBlIFwiUm9vdFF1ZXJ5XCIuYCxcbiAgICAgIC8vIEB0b2RvIHJlcGxhY2UgdGhpcyBsaW5rIHdpdGggYW5vdGhlciBvbmNlIHdlJ3JlIG91dCBvZiBhbHBoYVxuICAgICAgdG86IGBXUEdhdHNieSBpcyBub3QgYWN0aXZlIGluIHlvdXIgV29yZFByZXNzIGluc3RhbGxhdGlvbi5cXG5UbyBkb3dubG9hZCB0aGUgbGF0ZXN0IHZlcnNpb25zIG9mIFdQR2F0c2J5IGFuZCBXUEdyYXBoTCwgdmlzaXQ6XFxuaHR0cHM6Ly9naXRodWIuY29tL1R5bGVyQmFybmVzL3VzaW5nLWdhdHNieS1zb3VyY2Utd29yZHByZXNzLWV4cGVyaW1lbnRhbC90cmVlL21hc3Rlci9Xb3JkUHJlc3MvcGx1Z2luc2AsXG4gICAgfSxcbiAgICBwYW5pY09uRXJyb3I6IHRydWUsXG4gIH0pXG5cbmNvbnN0IGVuc3VyZVBsdWdpblJlcXVpcmVtZW50c0FyZU1ldCA9IGFzeW5jIChoZWxwZXJzLCBfcGx1Z2luT3B0aW9ucykgPT4ge1xuICBpZiAoaGVscGVycy50cmFjZUlkID09PSBgcmVmcmVzaC1jcmVhdGVTY2hlbWFDdXN0b21pemF0aW9uYCkge1xuICAgIHJldHVyblxuICB9XG5cbiAgY29uc3Qge1xuICAgIGRlYnVnOiB7IGRpc2FibGVDb21wYXRpYmlsaXR5Q2hlY2sgfSxcbiAgfSA9IGdldFBsdWdpbk9wdGlvbnMoKVxuXG4gIGF3YWl0IGlzV3BHYXRzYnkoKVxuXG4gIGlmICghZGlzYWJsZUNvbXBhdGliaWxpdHlDaGVjaykge1xuICAgIGF3YWl0IGFyZVJlbW90ZVBsdWdpblZlcnNpb25zU2F0aXNmaWVkKHsgaGVscGVycyB9KVxuICB9XG59XG5cbmV4cG9ydCB7IGVuc3VyZVBsdWdpblJlcXVpcmVtZW50c0FyZU1ldCB9XG4iXX0=